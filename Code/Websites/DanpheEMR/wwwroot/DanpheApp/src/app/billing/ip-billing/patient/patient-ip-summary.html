<style>
  .doc-pagecontainer .portlet .cstm-portlet-body table#editable-sample tr:nth-of-type(odd) td,
  .doc-pagecontainer .portlet table.doc-tbl tr:nth-of-type(odd) td,
  table.doc-tbl tr:nth-of-type(odd) td {
    background: transparent;
  }
</style>
<!-- <div class="popup-static portlet box portlet-fullscreen" *ngIf="loadingScreen === true">
  <div class="portlet-body form" style="background-color:white">
    <div style="display: flex; height: 100vh; align-items: center; justify-content: center; flex-direction: column;gap: 10px 0;"
         id='id_ip_billing_danpheLoading'>
      <h3>Please Wait...</h3>
      <div class="progress-bar">
        <div class="progress-fill"></div>
      </div>
    </div>
  </div>
</div> -->
<div class="popup-static portlet box portlet-fullscreen" *ngIf="loadingScreen === true">
  <div class="portlet-body form" style="background-color: white">
    <div style="display: flex; height: 100vh; align-items: center; justify-content: center; flex-direction: column; gap: 10px 0;"
         id="id_ip_billing_danpheLoading">
      <h3>Please Wait...</h3>
      <div class="progress-bar">
        <div class="progress-fill"></div>
      </div>
    </div>
  </div>
</div>

<div>
  <div>
    <div class="portlet-body form">
      <div class="row">
        <!--<button class="fa fa-close closeBtn btn-danger" (click)="ClosePatientSummary()"></button>-->

        <div class="col-md-12">
          <div class="ipbilling-wrap">
            <span class="col header inner-header" style="padding: 0px; margin: 0;">
              <i class="fa fa-file-text-o"></i>Inpatient Billing
            </span>
            <div class="col form-group" style="padding: 0px; width: 47%; margin: 0;"
                 *ngIf="SchemePriceCategoryFromVisit && SchemePriceCategoryFromVisit.SchemeId && SchemePriceCategoryFromVisit.PriceCategoryId">
              <scheme-pricecategory-select (on-change)="OnSchemePriceCategoryChanged($event)" [service-billing-context]="'ip-billing'"
                                           [selected-scheme-priceCategory]="SchemePriceCategoryFromVisit">
              </scheme-pricecategory-select>
            </div>
            <div *ngIf="ItemLevelDiscountSettings.ItemLevelDiscount && SchemePriceCategory.IsDiscountApplicable" class="col"
                 style="overflow: hidden; margin-left: 6px">
              <table>
                <tbody>
                  <tr>
                    <td><input type="checkbox" name="itemLevelCheckBox" id="itemLevelCheckBox"
                             [(ngModel)]="ipBillingDiscountModel.IsItemDiscountEnabled"
                             (ngModelChange)="SaveDiscountState(); ItemLevelCheckBoxChanged($event);" style="zoom: 1.5;"></td>
                    <td><label for="itemLevelCheckBox" style="margin-left: 5px"> Item Level Discount</label></td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="col" style="overflow: hidden; margin-left: 6px;" *ngIf="SchemePriceCategory.IsDiscountApplicable">
              <table>
                <tbody>
                  <tr>
                    <td><input id="id__ip_chk_enable_discount" name="enableDiscountAmount" [(ngModel)]="EnableDiscountAmountField" style="zoom: 1.5;"
                             type="checkbox" (ngModelChange)="EnableDiscountAmount()"></td>
                    <td><label for="id__ip_chk_enable_discount" style="margin-left: 5px">Enable Discount Amount</label></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="col-md-12 action-bar">
            <div class="actionbar-btn-wrap">
              <button class="btn action-btn btn-sm" (click)="BackToPatientListGrid()">
                <i class="fa fa-angle-left" style="margin-right: 5px;"></i> Back
              </button>
              <button class="btn btn-sm action-btn" (click)="NewItemBtn_Click()"
                      rbac-permission='{"name":"btn-ipdbilling-newitem","actionOnInvalid":"remove"}'>
                <i class="fa fa-plus" style="margin-right: 5px;"></i> New Item
              </button>
              <button class="btn btn-sm action-btn" (click)="ShowEstimationBill()"
                      rbac-permission='{"name":"btn-ipdbilling-estimationbill","actionOnInvalid":"remove"}'>
                Estimation
                Bill
              </button>
              <button class="btn btn-sm action-btn" style="display:none; margin-right: 5px;"> Cancel Item(s) </button>
              <button class="btn btn-sm action-btn" (click)="AddDepositBtn_Click()"
                      rbac-permission='{"name":"btn-ipdbilling-deposit","actionOnInvalid":"remove"}'>
                <i class="fa fa-plus" style="margin-right: 5px;"></i> Add Deposit
              </button>
              <button *ngIf="ItemLevelDiscountSettings.ItemLevelDiscount" class="btn btn-sm action-btn" (click)="GroupDiscountBtn_Click()"
                      rbac-permission='{"name":"btn-ipdbilling-groupdiscount","actionOnInvalid":"remove"}'
                      [attr.disabled]="enableItemLevelDiscount === false ? true : null">
                <i class="fa fa-folder-o" style="margin-right: 5px;"></i> Item Discount
              </button>
              <button class="btn btn-sm action-btn" (click)="UpdateItems()"
                      rbac-permission='{"name":"btn-ipdbilling-edititems","actionOnInvalid":"remove"}'>
                <i class="fa fa-pencil" style="margin-right: 5px;"></i> Edit Items
              </button>
              <button class="btn btn-sm action-btn" (click)="SelectItemForPartialPayment()"
                      rbac-permission='{"name":"btn-ipdbilling-partialclearance","actionOnInvalid":"remove"}'>
                <i class="fa fa-money" style="margin-right: 5px;"></i>Partial
                Clearance
              </button>
            </div>
            <label *ngIf="AdditionalBedReservationsObjectList && AdditionalBedReservationsObjectList.length"
                   style="color: red !important; cursor: pointer; padding: 0px 10px; border-radius: 5px !important; background-color: #fbe1e3 !important;"
                   (click)="OnAdditionalBedReservationClick()">
              Additional Bed Reservation({{AdditionalBedReservationsObjectList.length}})
            </label>
            <label *ngIf="admissionInfo && admissionInfo.DiscountSchemeId">Discount Scheme:
              <strong>{{admissionInfo.DiscountSchemeId}}</strong>
            </label>
            <!-- <label class="animated-btn blinking-btn" *ngIf="admissionInfo? admissionInfo.IsPoliceCase: false"
              style="color:orange!important; float:right; font-size: 20px;"> <strong>POLICE CASE</strong></label> -->
            <label *ngIf="admissionInfo && admissionInfo.AdmissionCase"
                   style="color:orange!important; background-color: #f8f9fa !important;">CASE:
              <strong>{{admissionInfo.AdmissionCase}}</strong>
            </label>
          </div>
        </div>
        <div class="col-md-12">
          <div class="row gutter-5">
            <div class="col-md-9">
              <div class="row page-bar" *ngIf="admissionInfo">
                <div class="col-md-6">
                  <table>
                    <tr>
                      <td style="width:40%"><i class="fa fa-arrow-circle-o-right "></i><b>Ip Number:</b></td>
                      <td><b>{{admissionInfo.IpNumber}}</b></td>
                    </tr>
                    <tr>
                      <td style="width:40%"><i class="fa fa-arrow-circle-o-right "></i><b>Ward/Bed:</b></td>
                      <td>
                        <b>
                          {{admissionInfo.BedsInformation.WardName}} /
                          {{admissionInfo.BedsInformation.BedNumber}}
                        </b>
                      </td>
                    </tr>
                    <tr>
                      <td style="width:40%"><i class="fa fa-arrow-circle-o-right "></i><b>Total Days:</b></td>
                      <td><b>{{totalDays}}</b></td>
                    </tr>
                    <tr *ngIf="ShowCaretakerContact">
                      <td style="width:40%"><i class="fa fa-arrow-circle-o-right "></i><b>Caretaker Contact:</b></td>
                      <td><b>{{admissionInfo.CareOfPersonPhoneNo}}</b></td>
                    </tr>
                    <tr>
                      <td style="width:40%"><i class="fa fa-arrow-circle-o-right "></i><b>Patient Remarks:</b></td>
                      <td>
                        <textarea class="form-control" type="text" maxlength="150"
                                  [(ngModel)]="admissionInfo.ProcedureType"></textarea>
                      </td>
                      <td>
                        <button class="btn btn-sm btn-default" (click)="UpdateProcedure()" [disabled]="loading"
                                style="margin-left:10px">
                          Update
                        </button>
                      </td>
                    </tr>
                  </table>
                </div>
                <div class="col-md-6">
                  <table style="width: 100%;">
                    <tr>
                      <td style="width:40%"><i class="fa fa-arrow-circle-o-right "></i><b>Admitting Doc:</b>&nbsp;&nbsp;</td>
                      <td><b>{{admissionInfo.AdmittingDoctorName}}</b></td>
                    </tr>
                    <tr>
                      <td style="width:40%"><i class="fa fa-arrow-circle-o-right "></i><b>Adm. Date:</b>&nbsp;&nbsp; </td>
                      <td>
                        <b>
                          <date-lbl [value]="admissionInfo.AdmittedOn" [show-time]="true"></date-lbl>
                        </b>
                      </td>
                    </tr>

                    <tr>
                      <td style="width:40%"><i class="fa fa-arrow-circle-o-right "></i><b>Disch. Date :</b>&nbsp;&nbsp; </td>
                      <td>
                        <danphe-date-picker [(ngModel)]="dischargeDetail.DischargeDate"
                                            (ngModelChange)="CalculateTotalDays()" [ngModelOptions]="{standalone: true}" [showTime]="true"
                                            [CalendarTypes]="'en,np'">
                        </danphe-date-picker>
                        <label class="color-red font-sm" *ngIf="!validDischargeDate">
                          Please enter Valid Discharge Date.
                        </label>
                      </td>
                    </tr>
                    <tr>
                      <td style="width:40%"><i class="fa fa-arrow-circle-o-right "></i><b>Credit Amount :</b>&nbsp;&nbsp; </td>
                      <td class="">
                        {{ CreditTotal }}
                      </td>
                    </tr>
                    <tr *ngIf="ConsultantDoctors" style="font-weight: bold;">
                      <td style="width:40%"><i class="fa fa-arrow-circle-o-right "></i><b>Consultants :</b>&nbsp;&nbsp; </td>
                      <td>
                        {{ ConsultantDoctors }}
                      </td>
                    </tr>
                    <tr *ngIf="SchemePriceCategory && (SchemePriceCategory.IsCreditLimited || SchemePriceCategory.IsGeneralCreditLimited)">
                      <td style="width:40%"><i class="fa fa-arrow-circle-o-right"></i><b>Credit Limit :</b>&nbsp;&nbsp; </td>
                      <td style="color:rgb(140, 18, 18);">
                        {{ CreditLimitToDisplay }}
                      </td>
                    </tr>

                  </table>
                </div>
              </div>
              <div class="row page-bar">
                <div class="col-md-12" style="font-weight: bold; font-size: 14px;">
                  <div *ngIf="PharmacyPendingAmount.ProvisionalAmount || PharmacyTotal" class="col-md-6">
                    <span>Pharmacy Pending <b>:</b></span> &nbsp; &nbsp;
                    <span style="padding: 0px; margin: 0px; color: #0773bc;">
                      <span *ngIf="PharmacyPendingAmount.ProvisionalAmount">Provisional <span class="">({{
                          PharmacyPendingAmount.ProvisionalAmount }}),</span></span>
                    </span> &nbsp; &nbsp;
                    <span *ngIf="PharmacyTotal">Unsettled Credit <span class="">({{ PharmacyTotal
                        }})</span></span>
                  </div>

                  <div *ngIf="BillingPreviousProvisional && BillingPreviousProvisional.BillingProvisionalAmount > 0" class="col-md-6">
                    <span>Previous Billing Pending <b>:</b></span> &nbsp; &nbsp;
                    <span style="padding: 0px; margin: 0px; color: #0773bc;">
                      <span>Provisional <span class="">
                          ({{BillingPreviousProvisional.BillingProvisionalAmount }})
                        </span>
                      </span>
                    </span>
                  </div>
                </div>
              </div>
              <div class="col-md-12 mb10">
                <danphe-grid [grid-colDefaults]="IPBillItemGridCol" [grid-data]="patAllPendingItems"
                             (grid-actions)="IPBillItemGridActions($event)" [show-print-button]="false" [supressPagination]="true"
                             [resizeColumnToFit]="false" [NepaliDateInGridParams]="NepaliDateInGridSettings"> </danphe-grid>
              </div>
              <div class="col-md-12 mb10" *ngIf="patAllCancelledItems && patAllCancelledItems.length">
                <label style="font-weight: 700;">Cancelled Services:</label>
                <danphe-grid [grid-colDefaults]="CancelledServicesGridCol" [grid-data]="patAllCancelledItems"
                             [show-print-button]="false" [supressPagination]="true"
                             [resizeColumnToFit]="false"> </danphe-grid>
              </div>


              <div class="col-md-12 mb10" *ngIf="pharmacyPendingBillItems.length">
                <label style="font-weight: 700;">PHARMACY ITEMS</label>
                <danphe-grid [grid-colDefaults]="IPPharmacyBillItemGridCol" [grid-data]="pharmacyPendingBillItems" [show-print-button]="false"
                             [supressPagination]="true" [resizeColumnToFit]="false" [NepaliDateInGridParams]="NepaliDateInGridSettings">
                </danphe-grid>
              </div>

              <!-- <label style="font-weight: 700;">Cancelled Services:</label>
              <div class="table-responsive item-holder-tbl table-wrapper">
                <table class="table doc-tbl table-striped inv_table padLess_table" style="background-color:initial;">
                  <thead>
                    <tr>
                      <th sortable-header col="Date"> <b>Date</b> </th>
                      <th sortable-header col="ReceiptNo"><b>ReceiptNo</b></th>
                      <th sortable-header col="RefReceiptNo"><b>Ref. ReceiptNo</b></th>
                      <th sortable-header col="Department"><b>Department</b></th>
                      <th sortable-header col="ItemName"><b>ItemName</b></th>
                      <th sortable-header col="Qty"><b>Qty</b></th>
                      <th sortable-header col="SubTotal"><b>SubTotal</b></th>
                      <th sortable-header col="DiscAmt"><b>DiscAmt</b></th>
                      <th sortable-header col="User"><b>User</b></th>
                      <th sortable-header col="Remarks"><b>Remarks</b></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let itm of CancelledItemDetails">
                      <td> {{itm.CreatedOn | DanpheDateTime:'format':'YYYY-MM-DD'}} </td>
                      <td> PRC/{{itm.CancellationReceiptNo}}</td>
                      <td> PR/{{itm.ReferenceProvisionalReceiptNo}}</td>
                      <td> {{itm.DepartmentName}}</td>
                      <td> {{itm.ItemName}}</td>
                      <td> {{itm.CancelledQty}}</td>
                      <td> {{itm.CancelledSubtotal}}</td>
                      <td> {{itm.CancelledDiscountAmount}}</td>
                      <td> {{itm.BillingUser}}</td>
                      <td> {{itm.CancellationRemarks}}</td>
                  </tbody>
                </table>
              </div> -->

            </div>
            <div class="col-md-3">
              <div class="page-bar ip-bill-pagebar">
                <table class="table doc-tbl" style="width:100%; margin-bottom: 10px;">
                  <!-- <tr *ngIf="model.PharmacyProvisionalAmount">
                    <td colspan="2" style="text-align:left;">
                      <p class="header-sm inner-header-sm">
                        <strong><i class="fa fa-pills"></i>Pharamacy Detail</strong>
                      </p>
                    </td>
                  </tr>
                  <tr *ngIf="model.PharmacyProvisionalAmount">
                    <td class="bill-child">Pharmacy Total</td>
                    <td style="font-weight:bold;">
                      <label style="font-weight:bold;">
                        {{model.PharmacyProvisionalAmount}}
                      </label>
                    </td>
                  </tr> -->
                  <tr>
                    <td colspan="2" style="text-align:left">
                      <p class="header-sm inner-header-sm">
                        <strong>
                          <i class="fa fa-file-text-o"></i>Billing
                          Detail
                        </strong>
                      </p>
                    </td>
                  </tr>
                  <tr>
                    <td class="bill-child"><label style="font-weight:bold;"> Sub Total </label></td>
                    <td><label style="font-weight:bold;"> {{model.SubTotal | number}} </label></td>
                  </tr>
                  <tr>
                    <td class="bill-child">Discount %</td>
                    <td>
                      <input type="number" style="width:100%; height: 25px;" [(ngModel)]="model.DiscountPercent" class="form-control"
                             [disabled]="DisableInvoiceDiscountPercent === true ? true : null"
                             onClick="this.select();"
                             (focusout)="this.InvoiceLevelDiscountChanged = true;InvoiceDiscountOnChange();SaveDiscountState()"
                             (wheel)="coreService.PreventNumberChangeOnScroll($event)" />
                      <label class="color-red font-sm" *ngIf="InvalidDiscount"> Enter Valid number. </label>
                    </td>
                  </tr>
                  <tr>
                    <td class="bill-child"> Discount Amt. </td>
                    <td>
                      <input type="number" class="form-control" [(ngModel)]="model.DiscountAmount"
                             [disabled]="(DisableInvoiceDiscountAmount === true ? true : null)"
                             style="width:100%; height: 25px;" (focusout)="ReCalculateDiscounts()"
                             (wheel)="coreService.PreventNumberChangeOnScroll($event)"
                             onclick="this.select();" />
                    </td>
                  </tr>
                  <tr style="font-weight:bold;">
                    <td class="bill-child" style="font-size: medium;">Billing Total </td>
                    <td><label style="font-weight:bold; font-size: medium;"> {{model.TotalAmount | number}} </label></td>
                  </tr>
                  <tr class="ht-managed" *ngIf="EnableShowOtherCurrency">
                    <td colspan="2">
                      <label for="id_showOtherCurrency_IPD_checkbox">
                        <input type="checkbox" id="id_showOtherCurrency_IPD_checkbox" [(ngModel)]="ShowOtherCurrency"
                               (ngModelChange)="ShowOtherCurrencyCheckBoxChanged()" style="zoom:1.25; height: auto; margin-bottom: 5px;">
                        Show Other Currency
                      </label>
                    </td>
                  </tr>
                  <tr *ngIf="DisplayOtherCurrencyDetail">
                    <td colspan="2">
                      <div class="col-md-12">

                        <other-currency-calculation [show-otherCurrencyCalculation]="DisplayOtherCurrencyDetail"
                                                    [base-TotalAmount]="model.TotalAmount"
                                                    (otherCurrencyCalculation-Callback)="OtherCurrencyCalculationCallback($event)"></other-currency-calculation>

                      </div>
                    </td>
                  </tr>
                  <tr style="font-weight:bold;height:40px" *ngIf="model.TotalAmountInUSD!=0">
                    <td class="bill-child">
                      In USD
                      <div style="color:indianred;font-size:smaller">
                        {{1 | currency}} = {{exchangeRate|currency:coreService.currencyUnit}}
                      </div>
                    </td>
                    <td><label style="font-weight:bold;"> {{model.TotalAmountInUSD | number | currency}} </label></td>
                  </tr>
                  <tr class="phrm-bill-detail" style="font-weight:bold;" *ngIf="SettlePharmacyCredits">
                    <td class="bill-child">Pharmacy Total </td>
                    <td><label style="font-weight:bold;"> {{model.PharmacyTotal | number}} </label></td>
                  </tr>
                  <tr class="phrm-bill-detail" style="font-weight:bold;">
                    <td class="bill-child">Grand Total </td>
                    <td><label style="font-weight:bold;" class=""> {{model.GrandTotal | number}} </label></td>
                  </tr>
                  <tr class="phrm-bill-detail" style="font-weight:bold;">
                    <td class="bill-child">
                      Deposit Balance
                    </td>
                    <td><label style="font-weight:bold;"> {{model.DepositBalance | number}} </label></td>
                  </tr>
                  <tr class="phrm-bill-detail" style="font-weight:bold;" *ngIf="model.ToBePaid && model.PayType != 'credit'">
                    <td class="bill-child" style="font-size:14px;">To Be Paid</td>
                    <td><label style="font-size:15px;"> {{model.ToBePaid | number}} </label></td>
                  </tr>
                  <tr class="dot" *ngIf="model.ToBePaid">
                    <td colspan="2" class="text-capitalize">
                      <p class="header-sm inner-header-sm">
                        In Words <span *ngIf="model.PayType != 'credit'">(To Pay)</span>:
                        {{model.ToBePaid | number | NumberInWords}}
                        Only.
                      </p>
                    </td>
                  </tr>
                  <tr style="font-weight:bold;" *ngIf="model.ToBeRefund">
                    <td class="bill-child" style="font-size:14px;">To Be Refund</td>
                    <td>
                      <label style="font-size:15px;background-color: #c8c3df !important;">
                        {{model.ToBeRefund | number}}
                      </label>
                    </td>
                  </tr>
                  <tr class="dot" *ngIf="model.ToBeRefund">
                    <td colspan="2" class="text-capitalize">
                      <p class="header-sm inner-header-sm">
                        In Words (To Return):
                        {{model.ToBeRefund | number | NumberInWords}}
                        Only.
                      </p>
                    </td>
                  </tr>

                  <tr class="ht-managed" style="height:50px;" *ngIf="SchemePriceCategory.IsCoPayment">
                    <td>
                      <span style="font-size: 20px;"><strong>CASH:</strong> </span>
                    </td>
                    <td>
                      <input [(ngModel)]="model.ReceivedAmount"
                             style="font-weight:bold;height: 50px;font-size:40px !important;background-color:#0773bc; color:#fff;"
                             disabled class="form-control pd-managed"
                             name="cash" type="number"
                             (wheel)="coreService.PreventNumberChangeOnScroll($event)"
                             onclick="this.select();"
                             [disabled]="selectedPriceCategoryObj.IsCoPayment ? null : true"
                             (focusout)="ReceivedAmountChange()">
                    </td>
                  </tr>
                  <tr class="ht-managed" *ngIf="SchemePriceCategory.IsCoPayment">
                    <td>
                      CoPayment Information:
                    </td>
                    <td>
                      <span>CoPaymentCashAmount: </span> <span><strong>{{ model.ReceivedAmount }}</strong></span>&nbsp;
                      <span>,CoPaymentCreditAmount: </span><span><strong>{{ model.CoPaymentCreditAmount }}</strong></span>
                    </td>
                  </tr>
                  <tr
                      *ngIf="(SchemePriceCategory.IsCoPayment || model.PayType === 'cash') && model.DepositBalance > 0 && DisplayDeductDepositCheckbox">
                    <td> <label for="id_input_chkbox_deductDeposit">Use Deposit?</label></td>
                    <td>
                      <input type="checkbox" name="" id="id_input_chkbox_deductDeposit" [(ngModel)]="UseDeposit"
                             (ngModelChange)="CalculationForAll()" style="zoom:1.5" />
                    </td>
                  </tr>


                  <tr *ngIf="SchemePriceCategory.IsCoPayment">
                    <td>
                      <span style="font-size: 20px;">PaymentMode:</span>
                    </td>
                    <td>
                      <span style="font-size: 20px;"> <strong>{{SchemePriceCategory.DefaultPaymentMode.toUpperCase()}}</strong> </span>
                    </td>
                  </tr>
                  <tr>
                    <td colspan="2">
                      <payment-mode-info
                                         [deposit-balance]="UseDeposit ? model.DepositBalance : 0"
                                         [total-amount]="totalAmountToPassToPaymentModeInfo"
                                         [actual-total-amount-to-compare-only]="model.TotalAmount"
                                         [page-name]="'IPBilling'"
                                         [default-credit-organization]="SchemePriceCategory.DefaultCreditOrganizationId"
                                         [default-payment-mode]="SchemePriceCategory.DefaultPaymentMode"
                                         [is-coPayment]="SchemePriceCategory.IsCoPayment"
                                         [is-credit-only-scheme]="SchemePriceCategory.IsCreditOnlyScheme"
                                         [disable-paymentMode-dropdown]="DisablePaymentModeDropDown"
                                         (on-paymentMode-change)=" PaymentModeChanges($event)"
                                         (on-creditOrganization-change)="CreditOrganizationChanges($event)"
                                         (on-multiple-paymentMode)="MultiplePaymentCallBack($event)">
                      </payment-mode-info>
                    </td>
                  </tr>
                  <tr *ngIf="model.PayType != 'credit' && model.ToBePaid">
                    <td class="bill-child">Tender:</td>
                    <td>
                      <input type="number" [(ngModel)]="model.Tender" (ngModelChange)="ChangeTenderAmount()"
                             name="Tender" placeholder="Rupees" [disabled]="model.PayType == 'credit'"
                             onClick="this.select();" (wheel)="coreService.PreventNumberChangeOnScroll($event)">
                    </td>
                  </tr>
                  <tr *ngIf="model.PayType != 'credit' && model.ToBePaid">
                    <td class="bill-child">Change/Return :</td>
                    <td><span><b>{{model.Change | number}}</b></span></td>
                  </tr>
                  <tr>
                    <td class="bill-child">Billing Remarks<b *ngIf="model.PayType=='credit' || model.DiscountPercent>0"
                         class="color-red"> *</b> :</td>
                    <td><textarea maxlength="200" [(ngModel)]="model.Remarks" id="id_ip_billing_remarks"
                                style="width: 100%; border: 1px solid #ccc; border-radius: 3px;"></textarea></td>
                  </tr>
                </table>
                <p *ngIf="model.PayType=='credit'" class="alert alert-danger">
                  *There will be
                  no deposit deduct / deposit return for <b>CREDIT</b> bill.
                </p>
                <div class="row">
                  <div class="col-md-6">
                    <label *ngIf="ShowAllowProvisionalDischargeCheckbox" for="id_provisional_discharge_checkbox"
                           style="display: flex; align-items: center; padding: 5px;"
                           rbac-permission='{"name":"billing-provisional-discharge","actionOnInvalid":"remove"}'>
                      <input type="checkbox" name="checkbox-provisional-discharge" id="id_provisional_discharge_checkbox"
                             [(ngModel)]="AllowProvisionalDischarge" (ngModelChange)="OnAllowProvisionalDischargeCheckboxChanged()" style="zoom: 1.5;"
                             rbac-permission='{"name":"billing-provisional-discharge","actionOnInvalid":"remove"}'>
                      Provisional Discharge?</label>
                  </div>
                  <div class="col-md-6">
                    <button *ngIf="!AllowProvisionalDischarge" class="btn green btn-success" style="float: right;margin-bottom: 10px;"
                            [disabled]="loading"
                            (click)="ConfirmDischarge()"
                            rbac-permission='{"name":"btn-ipdbilling-confirmdischarge","actionOnInvalid":"remove"}'>
                      Discharge
                    </button>

                    <button *ngIf="AllowProvisionalDischarge && ShowAllowProvisionalDischargeCheckbox" class="btn green btn-success"
                            style="float: right;margin-bottom: 10px;"
                            [disabled]="loading"
                            (click)="ConfirmProvisionalDischarge()"
                            rbac-permission='{"name":"btn-ipdbilling-confirmdischarge","actionOnInvalid":"remove"}'>
                      Provisional Discharge
                    </button>

                  </div>
                </div>

              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <ip-bill-item-request *ngIf="showIpBillRequest" [patientId]="patientId" [visitId]="ipVisitId"
                        [patientInfo]="patientInfo" [past-tests]="patAllPendingItems" (emit-billItemReq)="CloseNewItemAdd($event)"
                        [scheme-price-category]="SchemePriceCategoryObj"
                        [admitting-doctor]="admissionInfo.AdmittingDoctorName">
  </ip-bill-item-request>
  <div class="popup-static portlet box portlet-fullscreen custom_modal" *ngIf="showDepositPopUp">
    <div class="portlet-body form">
      <div class="row">
        <div class="col-md-6 col-md-offset-3">
          <div class="modelbox-div">
            <a class="btn btn-danger del-btn " (click)="CloseDepositPopUp()">X</a>
            <div class="form-body">
              <billing-deposit [isAddDepositFrmBillTxn]="showDepositPopUp" [depositFrom]="'ipBilling'" (emit-deposit)="CallBackDepositAdd($event)"
                               [showReceiptInput]="true"></billing-deposit>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="popup-static portlet box portlet-fullscreen custom_modal" *ngIf="showEstimationBill">
    <div class="portlet-body form">
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
          <div class="modelbox-div clearfix">
            <a class="btn btn-danger del-btn" (click)="CloseRecieptView()">X</a>
            <!-- [estimated-discountAmount]="estimatedDiscountAmount"
             [estimated-discountPercent]="estimatedDiscountPercent" -->
            <bil-print-ip-estimation [ipVisitId]="ipVisitId" [patientId]="patientId"
                                     [estimated-dischargeDate]="dischargeDetail.DischargeDate"
                                     [estimated-discountAmount]="estimatedDiscountAmount"
                                     [TotalAmountInUSD]="model.TotalAmountInUSD" [ExchangeRate]="exchangeRate" [IsDischarged]="IsProvisionalDischarge"
                                     [is-provisional-discharge]="IsProvisionalDischarge"
                                     (closeEstimationBill)="CloseDischargePopUp($event)"
                                     [DepositBalance]="model.DepositBalance">
            </bil-print-ip-estimation>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="popup-static portlet box portlet-fullscreen custom_modal" *ngIf="showDischargeBill">
    <div class="portlet-body form">
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
          <div class="modelbox-div clearfix">
            <a class="btn btn-danger del-btn" (click)="CloseRecieptView()">X</a>

            <!-- <bil-print-invoice-main [invoiceNumber]="bil_InvoiceNo" [fiscalYrId]="bil_FiscalYrId"
                                    [bil-txn-id]="bil_BilTxnId" (dischargeIp)="AfterDischargePrint($event)">
            </bil-print-invoice-main> -->
            <bil-print-invoice-main [invoiceNumber]="bil_InvoiceNo" [fiscalYrId]="bil_FiscalYrId" [bil-txn-id]="bil_BilTxnId"
                                    [discharge-statement-id]="DischargeStatementId" [patient-id]="PatientId" [patient-visit-id]="PatientVisitId"
                                    (dischargeIp)="AfterDischargePrint($event)">
            </bil-print-invoice-main>

          </div>
        </div>
      </div>
    </div>
  </div>



  <div class="popup-static portlet box portlet-fullscreen" *ngIf="admissionInfo && showDischargePopUpBox">
    <div class="portlet-body form">
      <div class="modelbox-div" style="margin-left:30%;margin-right:25%;margin-top:2%">
        <div style="margin:20px;">
          <table class="table table-striped text-center">
            <tr>
              <td><b>{{admissionInfo.PatientName}}</b></td>
              <td> Inpatient: <b>{{admissionInfo.IpNumber}}</b></td>
            </tr>
            <tr>
              <td>Hospital No: {{admissionInfo.PatientNo}}</td>
              <td> Age/Sex :{{admissionInfo.DateOfBirth | DanpheDateTime:'age'}} / {{admissionInfo.Gender}} </td>
            </tr>
          </table>
          <div class="text-center">
            <strong style="text-align:center;color:red">
              This will close inpatient billing and
              you won't be able to revert
              it.
            </strong><br />
            <strong style="text-align:center;color:red">Are you sure to discharge this patient?</strong><br />
          </div>
          <hr />
          <div> </div>
          <table class="table table-striped">
            <tr style="font-weight:bold;" *ngIf="model.ToBePaid">
              <td style="font-size:14px;">To Be Paid :</td>
              <td style="font-size:15px;background-color: #c8c3df !important;"><b>{{model.ToBePaid}}</b></td>
              <td style="font-size:14px;">Tender</td>
              <td style="font-size:15px;background-color:#c8c3df !important;"><b>{{model.Tender}}</b></td>
              <td style="font-size:14px;">Change</td>
              <td style="font-size:15px;background-color: #c8c3df !important;"><b>{{model.Change}}</b></td>
            </tr>
            <tr style="font-weight:bold;" *ngIf="model.ToBeRefund">
              <td style="font-size:14px;">To Be Refund :</td>
              <td style="font-size:15px;background-color: #d4e1ef !important;"><b>{{model.ToBeRefund}}</b></td>
            </tr>
          </table>
          <table class="table">
            <tr>
              <td>Admission Date:</td>
              <!--<td> {{admissionInfo.AdmittedOn | DanpheDateTime:'format':'YYYY-MM-DD hhA'}} </td>-->
              <td>
                <b>
                  <date-lbl [value]="admissionInfo.AdmittedOn" [show-time]="true"></date-lbl>
                </b>
              </td>
            </tr>
            <tr>
              <td> Discharge Date :</td>
              <td>
                <date-lbl [value]="dischargeDetail.DischargeDate" [show-time]="true"></date-lbl>
                <!-- <label>{{dischargeDetail.DischargeDate | date:'long'}}</label> -->
                <!-- <danphe-date-picker [(ngModel)]="dischargeDetail.DischargeDate" [ngModelOptions]="{standalone: true}"
                  [showTime]="true" [CalendarTypes]="'en,np'" (ngModelChange)="CalculateTotalDays()">
                </danphe-date-picker>
                <label class="color-red font-sm" *ngIf="!validDischargeDate">
                  Please enter Valid Discharge Date.
                </label> -->
              </td>
            </tr>
          </table>
          <div>
            Discharge Remarks :
            <textarea class="form-control" id="id_admitted_discharge_remarks" maxlength="100" [(ngModel)]="dischargeDetail.Remarks"
                      placeholder="Remarks"></textarea>
          </div>
          <hr />
          <div class="text-center">
            <ng-container *ngIf="allowDischarge">
              <button type="button" class="btn green btn-success" style="margin-top:5px;" [disabled]="loading"
                      (click)="PostBillAndDischargePatientPharmacyCharge()">
                Confirm Discharge
              </button>
            </ng-container>
            <ng-container *ngIf="!allowDischarge">
              <button type="button" class="btn green btn-success" style="margin-top:5px;" disabled>
                Confirm Discharge
              </button>
            </ng-container>
            <button type="button" class="btn btn-cancel btn-sm" style="margin-top:5px;" [disabled]="loading"
                    (click)="CloseDischargeConfirmPopUp()">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!--START: Provisional Discharge Confirmation-->

  <div class="popup-static portlet box portlet-fullscreen" *ngIf="admissionInfo && ShowProvisionalDischargeConfirmation">
    <div class="portlet-body form">
      <div class="modelbox-div" style="margin-left:30%;margin-right:25%;margin-top:2%">
        <div style="margin:20px;">
          <div style="text-align: center; color: red;">
            <h4>Provisional Discharge Confirmation!!!</h4>
          </div>
          <table class="table table-striped text-center">
            <tr>
              <td><b>{{admissionInfo.PatientName}}</b></td>
              <td> Inpatient: <b>{{admissionInfo.IpNumber}}</b></td>
            </tr>
            <tr>
              <td>Hospital No: {{admissionInfo.PatientNo}}</td>
              <td> Age/Sex :{{admissionInfo.DateOfBirth | DanpheDateTime:'age'}} / {{admissionInfo.Gender}} </td>
            </tr>
          </table>
          <div class="text-center">
            <strong style="text-align:center;color:red">
              * This will not impact the Sales.
            </strong><br />
            <strong style="text-align:center;color:red">
              * This will not generate Discharge Invoice.
            </strong><br />
            <strong style="text-align:center;color:red">
              * This will Only Release the Bed.
            </strong><br />
            <strong style="text-align:center;color:red">
              * This will not impact the Deposit and User Collection.
            </strong><br /> <br />
            <h3><strong style="text-align:center;color:red">Are you sure to discharge this patient?</strong><br /></h3>
          </div>
          <hr />
          <div> </div>
          <table class="table table-striped">
            <tr style="font-weight:bold;">
              <td style="font-size:14px;">Total Amount :</td>
              <td style="font-size:15px;"><b>{{model.TotalAmount}}</b></td>
              <td style="font-size:14px;">Deposit Balance :</td>
              <td style="font-size:15px;"><b>{{model.DepositBalance}}</b></td>
            </tr>
            <!-- <tr style="font-weight:bold;">
              <td style="font-size:14px;" *ngIf="model.ToBePaid">To Be Paid :</td>
              <td style="font-size:15px;" *ngIf="model.ToBePaid"><b>{{model.ToBePaid}}</b></td>
              <td style="font-size:14px;" *ngIf="model.ToBeRefund">To Be Refund :</td>
              <td style="font-size:15px;" *ngIf="model.ToBeRefund"><b>{{model.ToBeRefund}}</b></td>
            </tr> -->
          </table>
          <table class="table">
            <tr>
              <td>Admission Date:</td>
              <td>
                <b>
                  <date-lbl [value]="admissionInfo.AdmittedOn" [show-time]="true"></date-lbl>
                </b>
              </td>
            </tr>
            <tr>
              <td> Discharge Date :</td>
              <td>
                <date-lbl [value]="dischargeDetail.DischargeDate" [show-time]="true"></date-lbl>
              </td>
            </tr>
          </table>
          <div>
            Discharge Remarks :
            <textarea id="id_provisional_discharge_remarks" class="form-control" maxlength="100" [(ngModel)]="dischargeDetail.Remarks"
                      placeholder="Remarks"></textarea>
          </div>
          <hr />
          <div class="text-center">
            <ng-container *ngIf="allowDischarge">
              <button type="button" class="btn green btn-success" style="margin-top:5px;" [disabled]="loading"
                      (click)="PostProvisionalDischarge()">
                Confirm Provisional Discharge
              </button>
            </ng-container>
            <button type="button" class="btn btn-cancel btn-sm" style="margin-top:5px;" [disabled]="loading"
                    (click)="ShowProvisionalDischargeConfirmation=false;">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!--END: Provisional Discharge Confirmation-->

  <edit-bill-item *ngIf="showEditItemsPopup" [itemToEdit]="selItemForEdit" [discountApplicable]="discountApplicable"
                  (on-closed)="CloseItemEditWindow($event)" [DoctorsList]="doctorsList" [current-pat-info]="patientInfo">
  </edit-bill-item>



  <div class="popup-static portlet box portlet-fullscreen" *ngIf="showCancelAdmissionAlert">
    <div class="portlet-body form">
      <div class="col-md-5 col-md-offset-4">
        <div class="modelbox-div">
          <div class="modelbox-header">
            <h4 class="margin-0-vr" style="color:#bd8111;font-size:18px"><strong>Alert!</strong></h4>
          </div>
          <div class="modelbox-body">
            <div>
              <b style="color:#bd8111;font-size:14px">
                You're going to discharge a patient without billing, Are your Sure you want to proceed ?
              </b>
            </div>

            <div>
              Discharge Remarks <b style="color:red">*</b>:
              <textarea id="id_cancel_discharge_remarks" class="form-control" maxlength="100" [(ngModel)]="dischargeDetail.Remarks"
                        placeholder="Remarks"></textarea>
            </div>
          </div>
          <div class="modelbox-footer">
            <div class="all-buttons text-right">
              <button id="btnZeroItemCancel" type="button" class="btn btn-cancel margin-7-hr"
                      (click)="CloseZeroItemBillingPopUp()" [disabled]="loading"> Cancel
              </button>
              <button id="btnZeroItemProceed" type="button" class="btn btn-primary margin-7-hr"
                      (click)="ProceedDischargeWithZeroItems()" [disabled]="loading"> Proceed </button>
            </div>
          </div>
          <div class="close-modelbox">
            <button class="btn btn-danger" (click)="CloseZeroItemBillingPopUp()">X</button>
          </div>
        </div>
      </div>
    </div>
  </div>


  <div class="popup-static portlet box portlet-fullscreen" *ngIf="showCreditBillAlert">
    <div class="portlet-body form">
      <div class="modelbox-div" style="margin-left:30%;margin-right:25%;margin-top:2%">
        <div class="row">
          <div class="col-md-12" style="margin-top:15px;text-align:center">
            <h4><b style="color:#bd8111">Alert!</b></h4>
            <p>
              <b style="color:#bd8111;font-size:22px">
                Patient has previous credit bill, please clear it from
                Settlement.
              </b>
            </p>
            <hr />
          </div>
          <br />
          <div class="col-md-12" style="padding-bottom: 18px;text-align:center">
            <button type="button" class="btn btn-danger" (click)="showCreditBillAlert=false"> Close </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <group-discount *ngIf="showGroupDiscountPopUp" [estimated-dis-percent]="estimatedDiscountPercent"
                  [items-to-discount]="patAllPendingItems" [admissionInfo]="admissionInfo"
                  (close-popup)="CloseGroupDiscountPopup($event)" [enable-discount-amount]="EnableDiscountAmountField"> </group-discount>
  <update-items *ngIf="showUpdatePricePopup" [patientDetails]="admissionInfo" [filtered-items]="updatedItems"
                (close-popup)="CloseUpdatePricePopup($event)"> </update-items>
  <partial-payment *ngIf="showPartialPaymentPopup" [patientDetails]="admissionInfo"
                   [pat-all-items]="ItemForPartialPayment" (close-popup)="ClosePartialPaymentPopup($event)"> </partial-payment>

  <div class="popup-static portlet box portlet-fullscreen custom_modal" *ngIf="ShowOrderStatusInfo && !allowDischarge">
    <div class="portlet-body form">
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
          <div class="modelbox-div modelbox-custm clearfix">
            <div class="caption custom-caption">
              <h3><span><i class="glyphicon glyphicon-asterisk"></i>Bill Item Order status info</span></h3>
              <a class="btn btn-danger closeBtn" (click)="CloseOrderStatusInfoPopup()">X</a>
            </div>
            <div id="editPanel">
              <div class="patient_info_modal">
                <h4><i class="fa fa-user"></i>{{patientInfo.ShortName}}</h4>
                <ul>
                  <li><b><i class="fa fa-h-square"></i>Hospital No: </b> {{patientInfo.PatientCode}}</li>
                  <li><b><i class="fa fa-male"></i>Age/Sex:</b>{{patientInfo.Age}}/{{patientInfo.Gender}}</li>
                </ul>
              </div>
              <div class="col-md-12" style="margin-top:15px;text-align:center">
                <p>
                  <b style="color:#bd8111;font-size:20px">
                    Few Tests are Pending for this Patients, Please Consult with Respective Department Before
                    Proceeding.
                  </b>
                </p>
                <hr />
              </div>
              <table class="table doc-tbl custom_table table-bordered padLess_table">
                <thead>
                  <tr>
                    <th>S.N.</th>
                    <th>Service Department Name</th>
                    <th>Item Name</th>
                    <th>Price</th>
                    <th>Qty.</th>
                    <th>Sub Total</th>
                    <th>Dis. Amt.</th>
                    <th>Total Amount</th>
                    <th>Order Status</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let itm of  OrderStatusRestrictedItems;let i = index">
                    <td>{{i+1}}</td>
                    <td>{{itm.ServiceDepartmentName}}</td>
                    <td>{{itm.ItemName}}</td>
                    <td>{{itm.Price}}</td>
                    <td>{{itm.Quantity}}</td>
                    <td>{{itm.SubTotal}}</td>
                    <td>{{itm.DiscountAmount}}</td>
                    <td>{{itm.TotalAmount}}</td>
                    <td style="color:red">{{itm.OrderStatus}}</td>
                  </tr>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <div class="popup-static portlet box portlet-fullscreen" *ngIf="showDepositReceipt">
    <div class="portlet-body form">
      <div class="col-md-8 col-md-offset-2">
        <div class="modelbox-div">
          <div class="modelbox-body" style="display: flex;justify-content: center;">
            <bil-print-deposit-slip [deposit]="deposit" [showReceipt]="showDepositReceipt"
                                    (callback-close)="CloseDepositReceipt($event)"></bil-print-deposit-slip>
          </div>
          <div class="close-modelbox">
            <button class="btn btn-danger" (click)="CloseDepositReceipt()">X</button>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<!--START: Dynamic QR Popup -->
<fonepay-dynamic-qr *ngIf="ShowDynamicQr" [dynamic-qr-message]="DynamicQrMessage" [total-amount]="model.TotalAmount"
                    (callback-message)="OnDynamicQrCallback($event)"></fonepay-dynamic-qr>
<!--END: Dynamic QR Popup-->


<!--START: Additional Bed Reservation Popup -->
<div class="popup-static portlet box portlet-fullscreen" *ngIf="ShowAdditionalBedReservationsPopUp">
  <div class="portlet-body form">
    <div class="col-md-10 col-md-offset-1">
      <div class="modelbox-div">
        <div class="modelbox-body" style="display: flex;justify-content: center;">
          <div class="col-md-12">
            <table class="table table-striped table-hover" width="470" border="0" style="margin-left:15px;">
              <tr>
                <td colspan="5" align="left">
                  <b style="font-size:15px; text-decoration:underline; margin-right:20px">
                    Additional Bed Reservations for
                  </b>
                </td>
              </tr>
              <tr>
                <td colspan="5" align="left">
                  <i class="fa fa-user" aria-hidden="true" style="font-size: large; color: #68d2bd;"></i>
                  <span style="font-size: large; color: #68d2bd; margin-right: 25px;">{{admissionInfo.PatientName}}</span>
                  <span *ngIf="patientService.globalPatient.DateOfBirth" style="margin-right: 10px;">
                    <i *ngIf="patientService.globalPatient.Gender.toLowerCase() !== 'female'" class="fa fa-male" aria-hidden="true"></i>
                    <i *ngIf="patientService.globalPatient.Gender.toLowerCase() === 'female'" class="fa fa-female" aria-hidden="true"></i>
                    {{patientService.globalPatient.DateOfBirth | DanpheDateTime:'age'}}/{{patientService.globalPatient.Gender}}
                  </span>
                  <i class="fa fa-phone" aria-hidden="true"></i> {{admissionInfo.PhoneNumber}}
                </td>
              </tr>
              <tr>
                <td align="left"><b>S.N.</b></td>
                <td align="left"><b>Visitor Name</b></td>
                <td align="left"><b>Visitor Contact</b></td>
                <td align="left"><b>Secondary Visitor Detail</b></td>
                <td align="left"><b>Ward</b></td>
                <td align="left"><b>Bed Feature/Bed</b></td>
                <td align="left"><b>Created On</b></td>
                <td align="left"><b>Status</b></td>
                <td align="left"><b>Completed On</b></td>
              </tr>
              <tr *ngFor="let addBedRes of  AdditionalBedReservationsObjectList; let i = index">
                <td align="left"> {{i+1}} </td>
                <td align="left"> {{addBedRes.PrimaryCareTakerName}} </td>
                <td align="left"> {{addBedRes.PrimaryCareTakerContact}} </td>
                <td align="left">
                  {{addBedRes.SecondaryCareTakerName}}
                  <span *ngIf="addBedRes.SecondaryCareTakerContact">, {{addBedRes.SecondaryCareTakerContact}}</span>
                </td>
                <td align="left"> {{addBedRes.WardName}} </td>
                <td align="left"> {{addBedRes.BedFeatureName}}/{{addBedRes.BedNumber}} </td>
                <td align="left">
                  <span *ngIf="addBedRes.CreatedOn">
                    <date-lbl [value]="addBedRes.CreatedOn" [show-time]="true"></date-lbl>
                  </span>
                </td>
                <td align="left"> {{addBedRes.Status}} </td>
                <td align="left">
                  <span *ngIf="addBedRes.CompletedOn">
                    <date-lbl [value]="addBedRes.CompletedOn" [show-time]="true"></date-lbl>
                  </span>
                  <span *ngIf="!addBedRes.CompletedOn">
                    N/A
                  </span>
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div class="close-modelbox">
          <button class="btn btn-danger" (click)="CloseAdditionalBedReservationsPopUp()">X</button>
        </div>
      </div>
    </div>
  </div>
</div>
<!--END: Additional Bed Reservation Popup-->